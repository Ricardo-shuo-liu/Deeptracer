### 环境设置

#### 推荐（包含所有开发工具）
```bash
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境（Windows PowerShell）
.\.venv\Scripts\Activate.ps1

# 或 Linux/Mac
source .venv/bin/activate

# 升级 pip 并安装项目及开发依赖
python -m pip install --upgrade pip
pip install -e '.[dev]'
```

#### 最小安装（仅运行代码）
```bash
pip install -e .
```

### 代码质量工具

#### Pre-commit 钩子（自动格式化与 lint）
```bash
# 安装 git 钩子（在提交前自动运行检查）
pre-commit install

# 手动运行所有钩子
pre-commit run --all-files

# 运行特定钩子
pre-commit run black --all-files
pre-commit run flake8 --all-files
```

#### 手动工具运行
```bash
# 代码格式化（black 与 isort）
black .
isort .

# 静态检查（flake8）
flake8 .
```

### 运行测试

#### 快速测试
```bash
pytest
```

#### 生成覆盖率报告
```bash
pytest --cov=deeptracer --cov-report=html
# 在 htmlcov/index.html 中查看详细报告
```

#### 运行特定测试文件
```bash
pytest test/agentCoze/test_agentCoze_print_color.py
```

## CI/GitHub Actions

### 工作流说明

当你向 \main\ 分支提交 Pull Request 或 push 时，GitHub Actions 会自动运行以下工作流：

**文件**: \.github/workflows/PyTest.yml\

#### 执行步骤
1. **Pre-commit 检查** (\pre-commit run --all-files\)
   - 运行 black、isort、flake8、end-of-file-fixer、trailing-whitespace 等钩子
   - 格式化与 lint 问题会在日志中显示

2. **Flake8 lint** (\lake8 .\)
   - 额外的静态代码分析

3. **Pytest 测试** (\pytest --cov=...\)
   - 运行单元测试
   - 生成覆盖率报告（JUnit XML 与 coverage XML）

4. **Artifact 上传**
   - 测试报告可在 Actions 页面下载

#### 测试矩阵
- Python 3.10

#### 查看结果
- 在 GitHub 上进入 **Pull Request**  **Checks** 标签查看工作流状态
- 点击 **Details** 查看详细日志
- 点击 **Artifacts** 下载测试报告

### 在本地复现 CI 环境
```bash
# 安装所有开发依赖
pip install -e '.[dev]'

# 按 CI 工作流顺序运行
pre-commit run --all-files
flake8 .
mkdir reports
pytest -q --maxfail=1 --junitxml=reports/junit.xml --cov=deeptracer --cov-report=xml:reports/coverage.xml
```

### 配置文件
- \.github/workflows/PyTest.yml\ - 主 CI 工作流
- \.pre-commit-config.yaml\ - pre-commit 钩子配置
- \.flake8\ - flake8 lint 规则配置
- \pyproject.toml\ - 项目配置与开发依赖


